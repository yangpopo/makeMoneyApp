import{H as R,aC as fe,a4 as _,aV as J,d as A,J as j,aA as D,a5 as $,r as k,P as T,ad as ae,aH as ve,av as le,a as m,K as ie,Y as Z,N as B,O as he,M as pe,$ as be,Q as z,L as ge,a6 as W,V as Oe,au as Te,a7 as X,b3 as xe,b4 as q,Z as ke,b5 as Ce,o as ye,m as we,w as Pe,D as _e,u as N,_ as Ee}from"./index-BHC9SGJp.js";import{u as ce}from"./use-expose-DedaC2ld.js";import{u as Se}from"./use-touch-Oq4AsWfP.js";import{P as Ie}from"./function-call-BZ0bvZD1.js";/* empty css                                                                 */const[He,g,ee]=R("picker"),se=e=>e.find(a=>!a.disabled)||e[0];function Me(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function V(e,a){a=J(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const te=(e,a,n)=>a!==void 0&&!!e.find(s=>s[n.value]===a);function Q(e,a,n){const s=e.findIndex(r=>r[n.value]===a),i=V(e,s);return e[i]}function De(e,a,n){const s=[];let i={[a.children]:e},r=0;for(;i&&i[a.children];){const f=i[a.children],h=n.value[r];if(i=fe(h)?Q(f,h,a):void 0,!i&&f.length){const u=se(f)[a.value];i=Q(f,u,a)}r++,s.push(f)}return s}function Ne(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Be(e){return _({text:"text",value:"value",children:"children"},e)}const ne=200,oe=300,Ve=15,[ue,G]=R("picker-column"),re=Symbol(ue);var $e=A({name:ue,props:{value:j,fields:D(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:D(Number),swipeDuration:D(j),visibleOptionNum:D(j)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let s,i,r,f,h;const u=k(),p=k(),d=k(0),v=k(0),C=Se(),y=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,x=c=>{let t=V(e.options,c);const o=-t*e.optionHeight,l=()=>{t>y()-1&&(t=V(e.options,c));const O=e.options[t][e.fields.value];O!==e.value&&a("change",O)};s&&o!==d.value?h=l:l(),d.value=o},b=()=>e.readonly||!e.options.length,Y=c=>{s||b()||(h=null,v.value=ne,x(c),a("clickOption",e.options[c]))},w=c=>J(Math.round(-c/e.optionHeight),0,y()-1),M=T(()=>w(d.value)),F=(c,t)=>{const o=Math.abs(c/t);c=d.value+o/.003*(c<0?-1:1);const l=w(c);v.value=+e.swipeDuration,x(l)},E=()=>{s=!1,v.value=0,h&&(h(),h=null)},U=c=>{if(!b()){if(C.start(c),s){const t=Ne(p.value);d.value=Math.min(0,t-H())}v.value=0,i=d.value,r=Date.now(),f=i,h=null}},L=c=>{if(b())return;C.move(c),C.isVertical()&&(s=!0,ie(c,!0));const t=J(i+C.deltaY.value,-(y()*e.optionHeight),e.optionHeight),o=w(t);o!==M.value&&a("scrollInto",e.options[o]),d.value=t;const l=Date.now();l-r>oe&&(r=l,f=t)},S=()=>{if(b())return;const c=d.value-f,t=Date.now()-r;if(t<oe&&Math.abs(c)>Ve){F(c,t);return}const l=w(d.value);v.value=ne,x(l),setTimeout(()=>{s=!1},0)},P=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const l=t[e.fields.text],{disabled:O}=t,I=t[e.fields.value],de={role:"button",style:c,tabindex:O?-1:0,class:[G("item",{disabled:O,selected:I===e.value}),t.className],onClick:()=>Y(o)},me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return m("li",de,[n.option?n.option(t,o):m("div",me,null)])})};return ae(re),ce({stopMomentum:E}),ve(()=>{const c=s?Math.floor(-d.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=V(e.options,c),o=-t*e.optionHeight;s&&t<c&&E(),d.value=o}),le("touchmove",L,{target:u}),()=>m("div",{ref:u,class:G(),onTouchstartPassive:U,onTouchend:S,onTouchcancel:S},[m("ul",{ref:p,style:{transform:`translate3d(0, ${d.value+H()}px, 0)`,transitionDuration:`${v.value}ms`,transitionProperty:v.value?"all":"none"},class:G("wrapper"),onTransitionend:E},[P()])])}});const[Re]=R("picker-toolbar"),K={title:String,cancelButtonText:String,confirmButtonText:String},Ae=["cancel","confirm","title","toolbar"],Ke=Object.keys(K);var Ye=A({name:Re,props:K,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const s=()=>{if(n.title)return n.title();if(e.title)return m("div",{class:[g("title"),"van-ellipsis"]},[e.title])},i=()=>a("cancel"),r=()=>a("confirm"),f=()=>{var u;const p=(u=e.cancelButtonText)!=null?u:ee("cancel");if(!(!n.cancel&&!p))return m("button",{type:"button",class:[g("cancel"),Z],onClick:i},[n.cancel?n.cancel():p])},h=()=>{var u;const p=(u=e.confirmButtonText)!=null?u:ee("confirm");if(!(!n.confirm&&!p))return m("button",{type:"button",class:[g("confirm"),Z],onClick:r},[n.confirm?n.confirm():p])};return()=>m("div",{class:g("toolbar")},[n.toolbar?n.toolbar():[f(),s(),h()]])}});const[Fe,Xe]=R("picker-group"),Ue=Symbol(Fe);_({tabs:$(),activeTab:B(0),nextStepText:String},K);const Le=_({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:he,swipeDuration:B(1e3),visibleOptionNum:B(6)},K),je=_({},Le,{columns:$(),modelValue:$(),toolbarPosition:pe("top"),columnsFieldNames:Object});var ze=A({name:He,props:je,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const s=k(),i=k(e.modelValue.slice(0)),{parent:r}=ae(Ue),{children:f,linkChildren:h}=be(re);h();const u=T(()=>Be(e.columnsFieldNames)),p=T(()=>Te(e.optionHeight)),d=T(()=>Me(e.columns,u.value)),v=T(()=>{const{columns:t}=e;switch(d.value){case"multiple":return t;case"cascade":return De(t,u.value,i);default:return[t]}}),C=T(()=>v.value.some(t=>t.length)),y=T(()=>v.value.map((t,o)=>Q(t,i.value[o],u.value))),H=T(()=>v.value.map((t,o)=>t.findIndex(l=>l[u.value.value]===i.value[o]))),x=(t,o)=>{if(i.value[t]!==o){const l=i.value.slice(0);l[t]=o,i.value=l}},b=()=>({selectedValues:i.value.slice(0),selectedOptions:y.value,selectedIndexes:H.value}),Y=(t,o)=>{x(o,t),d.value==="cascade"&&i.value.forEach((l,O)=>{const I=v.value[O];te(I,l,u.value)||x(O,I.length?I[0][u.value.value]:void 0)}),X(()=>{a("change",_({columnIndex:o},b()))})},w=(t,o)=>{const l={columnIndex:o,currentOption:t};a("clickOption",_(b(),l)),a("scrollInto",l)},M=()=>{f.forEach(o=>o.stopMomentum());const t=b();return X(()=>{a("confirm",t)}),t},F=()=>a("cancel",b()),E=()=>v.value.map((t,o)=>m($e,{value:i.value[o],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:p.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>Y(l,o),onClickOption:l=>w(l,o),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:o})}},{option:n.option})),U=t=>{if(C.value){const o={height:`${p.value}px`},l={backgroundSize:`100% ${(t-p.value)/2}px`};return[m("div",{class:g("mask"),style:l},null),m("div",{class:[xe,g("frame")],style:o},null)]}},L=()=>{const t=p.value*+e.visibleOptionNum,o={height:`${t}px`};return m("div",{ref:s,class:g("columns"),style:o},[E(),U(t)])},S=()=>{if(e.showToolbar&&!r)return m(Ye,Oe(W(e,Ke),{onConfirm:M,onCancel:F}),W(n,Ae))};z(v,t=>{t.forEach((o,l)=>{o.length&&!te(o,i.value[l],u.value)&&x(l,se(o)[u.value.value])})},{immediate:!0});let P;return z(()=>e.modelValue,t=>{!q(t,i.value)&&!q(t,P)&&(i.value=t.slice(0),P=t.slice(0))},{deep:!0}),z(i,t=>{q(t,e.modelValue)||(P=t.slice(0),a("update:modelValue",P))},{immediate:!0}),le("touchmove",ie,{target:s}),ce({confirm:M,getSelectedOptions:()=>y.value}),()=>{var t,o;return m("div",{class:g()},[e.toolbarPosition==="top"?S():null,e.loading?m(ge,{class:g("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),L(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?S():null])}}});const et=ke(ze),qe=A({__name:"popupBox",props:["option"],setup(e,{expose:a}){const n=e;let{option:s}=Ce(n),i=k(!1);return a({isShow:i}),(r,f)=>(ye(),we(N(Ie),{show:N(i),teleport:"body",round:N(s).round||!1,position:N(s).position||"bottom","z-index":"100","safe-area-inset-bottom":!0},{default:Pe(()=>[_e(r.$slots,"default",{},void 0,!0)]),_:3},8,["show","round","position"]))}}),tt=Ee(qe,[["__scopeId","data-v-cfa40f52"]]);export{et as P,tt as p};
