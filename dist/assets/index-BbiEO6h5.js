import{aQ as q,a6 as X,D as k,J as m,a2 as D,av as ee,at as L,au as oe,M as g,b0 as te,E as _,r as w,C as R,d as K,ag as N,a as f,v as $,Y as M,Q as ne,ac as j,x as F,O as G,h as H,G as T,K as ae,aB as se,aC as le,aH as ce,T as re,F as ie,P as p,ab as ue,U as de,I as fe}from"./index-DOklq4cR.js";import{u as ve}from"./use-expose-Ds_Trjn3.js";import{u as me}from"./use-touch-S_0Of6sv.js";import{P as ye}from"./on-popup-reopen-B-mOa00z.js";import{u as A}from"./use-scope-id-B3BqUmx-.js";function he(e,{args:o=[],done:t,canceled:c,error:a}){if(e){const s=e.apply(null,o);q(s)?s.then(l=>{l?t():c&&c()}).catch(a||X):s?t():c&&c()}else t()}let Ie=2e3;const Oe=()=>++Ie,U={show:Boolean,zIndex:k,overlay:m,duration:k,teleport:[String,Object],lockScroll:m,lazyRender:m,beforeClose:Function,overlayStyle:Object,overlayClass:D,transitionAppear:Boolean,closeOnClickOverlay:m},De=Object.keys(U);let h=0;const B="van-overflow-hidden";function Pe(e,o){const t=me(),c="01",a="10",s=i=>{t.move(i);const v=t.deltaY.value>0?a:c,x=te(i.target,e.value),{scrollHeight:y,offsetHeight:O,scrollTop:P}=x;let u="11";P===0?u=O>=y?"00":"01":P+O>=y&&(u="10"),u!=="11"&&t.isVertical()&&!(parseInt(u,2)&parseInt(v,2))&&_(i,!0)},l=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",s,{passive:!1}),h||document.body.classList.add(B),h++},r=()=>{h&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",s),h--,h||document.body.classList.remove(B))},b=()=>o()&&l(),I=()=>o()&&r();ee(b),L(I),oe(I),g(o,i=>{i?l():r()})}function Y(e){const o=w(!1);return g(e,t=>{t&&(o.value=t)},{immediate:!0}),t=>()=>o.value?t():null}const[Ce,ke]=R("overlay"),we={show:Boolean,zIndex:k,duration:k,className:D,lockScroll:m,lazyRender:m,customStyle:Object};var be=K({name:Ce,props:we,setup(e,{slots:o}){const t=w(),c=Y(()=>e.show||!e.lazyRender),a=l=>{e.lockScroll&&_(l,!0)},s=c(()=>{var l;const r=M(ne(e.zIndex),e.customStyle);return j(e.duration)&&(r.animationDuration=`${e.duration}s`),F(f("div",{ref:t,style:r,class:[ke(),e.className]},[(l=o.default)==null?void 0:l.call(o)]),[[G,e.show]])});return N("touchmove",a,{target:t}),()=>f($,{name:"van-fade",appear:!0},{default:s})}});const xe=H(be),Se=M({},U,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Te,E]=R("popup");var ge=K({name:Te,inheritAttrs:!1,props:Se,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:t,slots:c}){let a,s;const l=w(),r=w(),b=Y(()=>e.show||!e.lazyRender),I=ae(()=>{const n={zIndex:l.value};if(j(e.duration)){const d=e.position==="center"?"animationDuration":"transitionDuration";n[d]=`${e.duration}s`}return n}),i=()=>{a||(a=!0,l.value=e.zIndex!==void 0?+e.zIndex:Oe(),o("open"))},v=()=>{a&&he(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},x=n=>{o("clickOverlay",n),e.closeOnClickOverlay&&v()},y=()=>{if(e.overlay)return f(xe,p({show:e.show,class:e.overlayClass,zIndex:l.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},A(),{onClick:x}),{default:c["overlay-content"]})},O=n=>{o("clickCloseIcon",n),v()},P=()=>{if(e.closeable)return f(fe,{role:"button",tabindex:0,name:e.closeIcon,class:[E("close-icon",e.closeIconPosition),de],classPrefix:e.iconPrefix,onClick:O},null)};let u;const V=()=>{u&&clearTimeout(u),u=setTimeout(()=>{o("opened")})},Z=()=>o("closed"),Q=n=>o("keydown",n),J=b(()=>{var n;const{round:d,position:C,safeAreaInsetTop:S,safeAreaInsetBottom:W}=e;return F(f("div",p({ref:r,style:I.value,role:"dialog",tabindex:0,class:[E({round:d,[C]:C}),{"van-safe-area-top":S,"van-safe-area-bottom":W}],onKeydown:Q},t,A()),[(n=c.default)==null?void 0:n.call(c),P()]),[[G,e.show]])}),z=()=>{const{position:n,transition:d,transitionAppear:C}=e,S=n==="center"?"van-fade":`van-popup-slide-${n}`;return f($,{name:d||S,appear:C,onAfterEnter:V,onAfterLeave:Z},{default:J})};return g(()=>e.show,n=>{n&&!a&&(i(),t.tabindex===0&&ue(()=>{var d;(d=r.value)==null||d.focus()})),!n&&a&&(a=!1,o("close"))}),ve({popupRef:r}),Pe(r,()=>e.show&&e.lockScroll),N("popstate",()=>{e.closeOnPopstate&&(v(),s=!1)}),se(()=>{e.show&&i()}),le(()=>{s&&(o("update:show",!0),s=!1)}),L(()=>{e.show&&e.teleport&&(v(),s=!0)}),ce(ye,()=>e.show),()=>e.teleport?f(re,{to:e.teleport},{default:()=>[y(),z()]}):f(ie,null,[y(),z()])}});const Le=H(ge);export{xe as O,Le as P,De as a,he as c,U as p};
