import{aS as U,H as w,N as E,M as j,O as Y,d as y,r as D,at as R,P as F,Q as $,aT as I,h as K,av as V,a as l,a7 as A,ax as L,aw as O,L as C,Z as M,J as G,j as J,ao as Q,K as X}from"./index-BHC9SGJp.js";import{u as Z}from"./use-expose-DedaC2ld.js";import{u as q}from"./use-touch-Oq4AsWfP.js";const z=Symbol(),W=()=>U(z,null),[p,m,ee]=w("list"),te={error:Boolean,offset:E(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:j("down"),loadingText:String,finishedText:String,immediateCheck:Y};var ae=y({name:p,props:te,emits:["load","update:error","update:loading"],setup(e,{emit:f,slots:s}){const o=D(e.loading),g=D(),v=D(),T=W(),a=R(g),c=F(()=>e.scroller||a.value),u=()=>{A(()=>{if(o.value||e.finished||e.disabled||e.error||(T==null?void 0:T.value)===!1)return;const{direction:i}=e,h=+e.offset,r=L(c);if(!r.height||O(g))return;let S=!1;const k=L(v);i==="up"?S=r.top-k.top<=h:S=k.bottom-r.bottom<=h,S&&(o.value=!0,f("update:loading",!0),f("load"))})},x=()=>{if(e.finished){const i=s.finished?s.finished():e.finishedText;if(i)return l("div",{class:m("finished-text")},[i])}},_=()=>{f("update:error",!1),u()},d=()=>{if(e.error){const i=s.error?s.error():e.errorText;if(i)return l("div",{role:"button",class:m("error-text"),tabindex:0,onClick:_},[i])}},H=()=>{if(o.value&&!e.finished&&!e.disabled)return l("div",{class:m("loading")},[s.loading?s.loading():l(C,{class:m("loading-icon")},{default:()=>[e.loadingText||ee("loading")]})])};return $(()=>[e.loading,e.finished,e.error],u),T&&$(T,i=>{i&&u()}),I(()=>{o.value=e.loading}),K(()=>{e.immediateCheck&&u()}),Z({check:u}),V("scroll",u,{target:c,passive:!0}),()=>{var i;const h=(i=s.default)==null?void 0:i.call(s),r=l("div",{ref:v,class:m("placeholder")},null);return l("div",{ref:g,role:"feed",class:m(),"aria-busy":o.value},[e.direction==="down"?h:r,H(),x(),d(),e.direction==="up"?h:r])}}});const de=M(ae),[ne,P,se]=w("pull-refresh"),N=50,ie=["pulling","loosing","success"],oe={disabled:Boolean,modelValue:Boolean,headHeight:E(N),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:G,successDuration:E(500),animationDuration:E(300)};var le=y({name:ne,props:oe,emits:["change","refresh","update:modelValue"],setup(e,{emit:f,slots:s}){let o;const g=D(),v=D(),T=R(g),a=J({status:"normal",distance:0,duration:0}),c=q(),u=()=>{if(e.headHeight!==N)return{height:`${e.headHeight}px`}},x=()=>a.status!=="loading"&&a.status!=="success"&&!e.disabled,_=t=>{const n=+(e.pullDistance||e.headHeight);return t>n&&(t<n*2?t=n+(t-n)/2:t=n*1.5+(t-n*2)/4),Math.round(t)},d=(t,n)=>{const b=+(e.pullDistance||e.headHeight);a.distance=t,n?a.status="loading":t===0?a.status="normal":t<b?a.status="pulling":a.status="loosing",f("change",{status:a.status,distance:t})},H=()=>{const{status:t}=a;return t==="normal"?"":e[`${t}Text`]||se(t)},i=()=>{const{status:t,distance:n}=a;if(s[t])return s[t]({distance:n});const b=[];return ie.includes(t)&&b.push(l("div",{class:P("text")},[H()])),t==="loading"&&b.push(l(C,{class:P("loading")},{default:H})),b},h=()=>{a.status="success",setTimeout(()=>{d(0)},+e.successDuration)},r=t=>{o=Q(T.value)===0,o&&(a.duration=0,c.start(t))},S=t=>{x()&&r(t)},k=t=>{if(x()){o||r(t);const{deltaY:n}=c;c.move(t),o&&n.value>=0&&c.isVertical()&&(X(t),d(_(n.value)))}},B=()=>{o&&c.deltaY.value&&x()&&(a.duration=+e.animationDuration,a.status==="loosing"?(d(+e.headHeight,!0),f("update:modelValue",!0),A(()=>f("refresh"))):d(0))};return $(()=>e.modelValue,t=>{a.duration=+e.animationDuration,t?d(+e.headHeight,!0):s.success||e.successText?h():d(0,!1)}),V("touchmove",k,{target:v}),()=>{var t;const n={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return l("div",{ref:g,class:P()},[l("div",{ref:v,class:P("track"),style:n,onTouchstartPassive:S,onTouchend:B,onTouchcancel:B},[l("div",{class:P("head"),style:u()},[i()]),(t=s.default)==null?void 0:t.call(s)])])}}});const fe=M(le);export{de as L,fe as P,z as T};
